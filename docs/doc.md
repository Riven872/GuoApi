## 项目名称 OpenAPI-Plus

### 协作

1. GIt Gitee
2. 按照需求切分支



### 后端

1、整体架构

2、权限（后）

3、数据库 Redis 云



### 扩展

1. 登录
    1. 忘记密码
    2. 集成 GitHub
    3. 手机号注册、登录
    4. 自动登录
2. API 上传
    1. 用户上传，管理员审核
    2. 实名认证、资质认证



### 项目目录

1. common 公共实体、DTO
2. Gateway
3. backend 主目录
4. interface-test 测试流程







### 接口信息模块

1. 发布接口时，需要判断接口是否处于可调用状态，此时需要 SDK 中根据查询出不同的接口，提供一个方法去进行验证
2. 相应的，每发布一个接口，就需要重写一次发布接口的方法



### 用户信息模块

1. 用户登录时，可以把用户信息保存到 Redis 中。
2. 获取当前登录用户时，可以直接从 Redis 中获取，提高效率。



### SDK 模块

#### 1、调用特定的接口（测试使用时）

1. 该步骤留给签名加密
2. 调用一个接口，就新写一个方法
3. 解析请求的方法、请求的 URL、请求参数、请求头、响应头（或者不解析，直接写死）。
4. 开发者只需要传入 AK、SK，然后利用 SDK 调用指定的方法即可（方法中规定要传入的参数）。

#### 2、设置请求头

1. 间接通过 SDK 调用的另一个用处就是利用 SDK 添加请求头然后生成签名，目标接口利用请求头再次生成签名进行比对
2. 流程：
    1. 用户发出请求（backend）
    2. **SDK 添加请求头**并通过 http 请求目标接口
    3. 目标接口使用 SDK 加密生成签名并进行比对（目标接口需要查出用户的 secretKey 进行签名的生成）
3. 通过请求头传递参数，用来进行签名的认证
    1. accessKey
    2. 用户的请求参数（存疑）
    3. 随机数
    4. 当前时间戳
    5. 生成的签名
4. 目标接口进行解析
    1. 解析用户请求中的参数
    2. 解析用户请求中的请求头用做签名校验
    3. 查询用户是否有 accessKey
    4. 判断随机数是否超出规则限制
    5. 查询时间戳和当前时间差值是否超过规定时长



### RPC 模块

1. 网关模块只提供纯粹的网关服务，可以作为消费者
2. backend 可以作为方法提供者
3. 该模块用来专门提供方法、进行接口的定义规范，具体的实现交由负责该模块的实现类，相当于实现 Dubbo 的服务暴露
4. 提供的方法
    1. 查询数据库中是否已经分配密钥给该用户
    2. 查询数据库中调用的接口是否存在
    3. 接口调用次数统计




### 整合 RabbitMQ

1. 用户增加调用次数时，将请求发送到 Broker 中，然后等待消费者消费即可，无须在网关层等待



### Docker  部署  Nacos

1. 在云服务器上部署了单机的 Nacos 2.0.2，最新版会出错，出错 Log 、部署方式见文档
1. :star:本地起 Dubbo 无法注册到云服务的 Nacos



### Nacos

1. Dubbo 会将提供者的**接口**（有几个注册几个）、提供者的元信息、提供者本身注册到 Dubbo 中，消费者不会自动注册，因此需要手动集成 Nacos 注册进去
2. 所有的微服务模块都需要注册到 Nacos 中，其中集成 Dubbo 的模块已经自动注册完成，不需要单独注册。

